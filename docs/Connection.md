---
sidebar_position: 2
---

# 建立连接

## 通讯方式

**适配器** 和 **客户端** 间通过 *WebSocket* 进行通讯。

默认情况下， **适配器** 应开启一个 *WebSocket* 服务器进行监听。 **客户端** 发起 *握手* 从而建立连接。这种方式成为 `正向WebSocket`。

*（可选）* *WebSocket* 作为全双工协议，如有需要也可以由 **客户端** 开启服务器监听，并由 **适配器** 发起 *握手* 。这种方式称为 `反向WebSocket`。

除非 **适配器** 被关闭，否则 **适配器** 永远不应该主动关闭(close) WebSocket连接。当 **适配器** 的登录状态等情况发生变化时，应该发送 [**事件**](./events/intro) 来通知 **客户端**。

当 **客户端** 退出时应关闭(close) WebSocket连接。

*注： **C³** 不支持使用单个WebSocket连接控制多个账号。如果你真的需要实现多账号功能，请使用不同的URL建立多个WebSocket连接。*

## 数据编码

**C³** 使用 [**CBOR**](https://cbor.io/) 将被传输的对象序列化为二进制数据流并传输。**大小写敏感**。

后文中为了方便描述，我们将会使用序列化后的JSON来展示传输的数据。但是请记住 **C³** **仅**支持 [**CBOR**](https://cbor.io/) 进行二进制传输。

## 数据传输

*WebSocket* 连接建立后，存在两种方向的数据传输。

由 **适配器** 主动产生并发往 **客户端** 的数据叫作 [**事件**](./Events/intro)。

由 **客户端** 产生并发往 **适配器** 的数据叫作 [**请求**](./Requests/Intro)

由 **适配器** 对 [请求](./Requests/Intro) 进行处理后发回 **客户端** 的数据叫作 **响应**

在 **适配器** 对 [请求](./Requests/Intro) 进行处理时出现错误后发回 **客户端** 的数据叫作 **错误**


## 生命周期

无论使用 `正向WebSocket` 还是 `反向WebSocket` ，当 *WebSocket* 连接建立成功后， **适配器** 都应该向 **客户端** 发送 [**连接成功**](./Events/Connected) 事件。

**客户端** 向 **适配器** 发送请求